{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://github.com/Alathreon/AlaHexEditor/blob/master/src/main/resources/alahex.schema.json",
    "title": "AlaHexEditor parse format",
    "type": "object",
    "required": ["references", "endianness", "types", "schema"],
    "properties": {
        "references": {
            "type": "array",
            "items": { "type": "string", "format": "uri" }
        },
        "endianness": {
            "type": "string",
            "enum": ["BIG", "LITTLE"]
        },
        "types": {
            "type": "object",
            "additionalProperties": false,
            "patternProperties": {
                "\\w+": {
                    "$ref": "#/$defs/SchemaType"
                }
            }
        },
        "schema": {
            "type": "object",
            "additionalProperties": false,
            "patternProperties": {
                "\\w+": {
                    "$ref": "#/$defs/SchemaElement"
                }
            }
        }
    },
    "$defs": {
        "SchemaType": {
            "oneOf": [
                {
                    "type": "object",
                    "required": ["@type", "names"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "BitsetType" },
                        "names": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "size", "constants"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "EnumType" },
                        "size": { "$ref": "#/$defs/ByteSize" },
                        "constants": { "type": "object", "$ref": "#/$defs/Bindings" }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "members"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "StructType" },
                        "members": {
                            "type": "object",
                            "additionalProperties": false,
                            "patternProperties": {
                                "\\w+": {
                                    "$ref": "#/$defs/SchemaElement"
                                }
                            }
                        }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "classifier"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "UnionType" },
                        "classifier": { "type": "object", "$ref": "#/$defs/Classifier" }
                    }
                }
            ]
        },
        "SchemaElement": {
            "oneOf": [
                {
                    "type": "object",
                    "required": ["@type", "variable", "size"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "ArrayReferenceElement" },
                        "variable": { "type": "string" },
                        "size": { "$ref": "#/$defs/ByteSize" },
                        "zeroIsNull": { "type": "boolean", "default": false }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "lengthPolicy"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "BlobElement" },
                        "lengthPolicy": { "$ref": "#/$defs/LengthPolicy" }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "size", "lengthPolicy"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "StringElement" },
                        "lengthPolicy": { "$ref": "#/$defs/LengthPolicy" },
                        "charset": { "type": "string", "default": "UTF-8" },
                        "stopAtNull": { "type":  "boolean", "default": false }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "lengthPolicy", "schema"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "ArrayElement" },
                        "lengthPolicy": { "$ref": "#/$defs/LengthPolicy" },
                        "schema": { "$ref": "#/$defs/SchemaElement" }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "variables"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "ComputedIntElement" },
                        "variables": {
                            "type": "array",
                            "minItems": 1,
                            "items": { "type": "string" }
                        },
                        "expression": { "$ref": "#/$defs/Expression" }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "format", "variables"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "ComputedStringFormatElement" },
                        "format": { "type": "string" },
                        "variables": {
                            "type": "array",
                            "items": {
                                "type": "array",
                                "minItems": 1,
                                "items": { "type": "string" }
                            }
                        }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "size"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "IntElement" },
                        "size": { "$ref": "#/$defs/LongByteSize" },
                        "signed": { "type": "boolean", "default": false },
                        "expression": { "$ref": "#/$defs/Expression" }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "BoolElement" }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "size"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "FloatElement" },
                        "size": { "$ref": "#/$defs/LongByteSize" }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "name"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "TypeElement" },
                        "name": { "type": "string" }
                    }
                }
            ]
        },
        "Classifier": {
            "oneOf": [
                {
                    "type": "object",
                    "required": ["@type", "enumClassifierName"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "EnumClassifier" },
                        "enumClassifierName": { "type": "string" },
                        "overrideBindings": { "type": "object", "$ref": "#/$defs/Bindings", "default": [] }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "size", "bindings"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "SelfEnumClassifier" },
                        "size": { "$ref": "#/$defs/ByteSize" },
                        "bindings": { "type": "object", "$ref": "#/$defs/Bindings" }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "size", "rangeBindings"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "IntRangeClassifier" },
                        "size": { "$ref": "#/$defs/ByteSize" },
                        "rangeBindings": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "required": ["name", "from", "to"],
                                "properties": {
                                    "name": { "type": "string" },
                                    "from": { "$ref": "#/$defs/Decimal" },
                                    "to": { "$ref": "#/$defs/Decimal" }
                                }
                            }
                        }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "variable", "size"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "ArrayStringRefClassifier" },
                        "variable": { "type": "string" },
                        "size": { "$ref": "#/$defs/ByteSize" },
                        "zeroIsNull": { "type": "boolean", "default": false }
                    }
                }
            ]
        },
        "LengthPolicy": {
            "oneOf": [
                {
                    "type": "object",
                    "required": ["@type", "length"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "FixedLengthPolicy" },
                        "length": { "$ref": "#/$defs/Decimal" }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "fieldSize"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "PrefixedLengthPolicy" },
                        "fieldSize": { "$ref": "#/$defs/ByteSize" }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "sizeVarName"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "ReferencedLengthPolicy" },
                        "sizeVarName": { "type": "string" }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type", "against", "operator"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "PredicateTerminatedPolicy" },
                        "structField": { "type": "string", "default": null },
                        "against": { "$ref": "#/$defs/Decimal" },
                        "operator": { "type": "string", "enum": ["EQUALS", "NOT_EQUALS", "LESS_THAN", "LESS_THAN_OR_EQUALS", "MORE_THAN", "MORE_THAN_OR_EQUALS"] }
                    }
                },
                {
                    "type": "object",
                    "required": ["@type"],
                    "additionalProperties": false,
                    "properties": {
                        "@type": { "const": "NullTerminatedStringPolicy" }
                    }
                }
            ]
        },
        "Bindings": {
            "type": "array",
            "items": {
                "type": "object",
                "required": ["key", "value"],
                "additionalProperties": false,
                "properties": {
                    "key": { "$ref": "#/$defs/Decimal" },
                    "value": { "type": "string" }
                }
            }
        },
        "Decimal": {
            "oneOf": [
                {
                    "type": "integer"
                },
                {
                    "type": "string",
                    "pattern": "^(0x[0-9A-F]{1,16})|(0b[01]{1,64})|('.')$"
                }
            ]
        },
        "ByteSize": {
            "oneOf": [
                { "const": "1" },
                { "const": "2" },
                { "const": "4" }
            ]
        },
        "LongByteSize": {
            "oneOf": [
                { "const": "1" },
                { "const": "2" },
                { "const": "4" },
                { "const": "8" }
            ]
        },
        "Expression": {
            "type": "string",
            "pattern": "^(\\w+|\\d+|[+\\-*\/%])( (\\w+|\\d+|[+\\-*\/%]))*$"
        }
    }
}
